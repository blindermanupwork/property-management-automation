# Log rotation configuration for automation system
# Place this file in /etc/logrotate.d/automation

# Set user/group for all rotations
su opc opc

# Automation logs - Development
/home/opc/automation/src/automation/logs/automation_dev*.log {
    daily
    rotate 7
    missingok
    notifempty
    compress
    delaycompress
    create 644 opc opc
    sharedscripts
    postrotate
        # Optional: Send signal to restart process if needed
        # pkill -USR1 -f automation_dev || true
    endscript
}

# Automation logs - Production
/home/opc/automation/src/automation/logs/automation_prod*.log {
    daily
    rotate 7
    missingok
    notifempty
    compress
    delaycompress
    create 644 opc opc
}

# CSV sync logs
/home/opc/automation/src/automation/logs/csv_sync_*.log {
    daily
    rotate 14
    missingok
    notifempty
    compress
    delaycompress
    create 644 opc opc
    size 10M
}

# ICS sync logs
/home/opc/automation/src/automation/logs/ics_sync_*.log {
    daily
    rotate 14
    missingok
    notifempty
    compress
    delaycompress
    create 644 opc opc
    size 10M
}

# Webhook logs
/home/opc/automation/src/automation/logs/webhook*.log {
    daily
    rotate 14
    missingok
    notifempty
    compress
    delaycompress
    create 644 opc opc
    size 5M
}

# Note: Archive logs are handled by cleanup script instead

# Backup cron log
/home/opc/automation/src/automation/logs/backup_cron.log {
    weekly
    rotate 4
    missingok
    notifempty
    compress
    delaycompress
    create 644 opc opc
}

# System log - airscripts API
/var/log/airscripts-api.log {
    daily
    rotate 7
    missingok
    notifempty
    compress
    delaycompress
    create 644 opc opc
    size 10M
    sharedscripts
    postrotate
        systemctl reload airscripts-api 2>/dev/null || true
    endscript
}